<!DOCTYPE html>
<html lang="pt-br">

<head>
    <script src="../../Shared/JS/temas-lista.js"></script>
    <script src="../../Shared/JS/temas-core.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário de Escalas</title>
    <link rel="manifest" href="../../manifest.json">
    <script src="../../Shared/JS/config.js"></script>
    <link rel="stylesheet" href="../../assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../assets/Font Awesome/css/all.css">
    <link rel="stylesheet" href="../../Shared/CSS/main.css">
    <link rel="stylesheet" href="../CSS/escala-calendario.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>

<body>

    <div class="header-bar">
        <div class="header-left-nav">
            <i class="fas fa-arrow-left nav-btn" onclick="window.location.href='MenuEscalas.html'" title="Voltar"></i>
            <i class="fas fa-home nav-btn" onclick="window.location.href='../../index.html'" title="Início"></i>
        </div>
        <h2 class="header-title">Calendário</h2>
        <div class="header-right-nav">
            <i class="fas fa-palette nav-btn" onclick="toggleThemePanel()" title="Trocar Tema"></i>
            <i class="fas fa-sync-alt nav-btn" onclick="loadData(true)" title="Sincronizar"></i>
        </div>
    </div>

    <div id="themePanel" class="theme-panel">
        <h3>Escolha um Tema</h3>
        <div class="theme-buttons" id="themeButtonsGrid"></div>
        <button class="apply-btn" onclick="confirmarTema()">USAR ESTE TEMA</button>
    </div>

    <!-- MODAL AVISO MEMBRO -->
    <div id="modalAvisoMembro" class="modal"
        style="display:none; position:fixed; z-index:10001; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter:blur(8px); align-items:center; justify-content:center; padding:15px;">
        <div class="modal-content"
            style="background:#fff; padding:30px; border-radius:24px; width:100%; max-width:400px; position:relative;">
            <span class="close-modal" onclick="fecharModalAvisoMembro()"
                style="position:absolute; right:20px; top:20px; font-size:1.5rem; cursor:pointer;">&times;</span>
            <h3 style="margin-top:0; font-weight:800; color:var(--primary);">Comunicar Aviso</h3>
            <p style="font-size:0.85rem; color:#64748b; margin-bottom:15px;">
                Culto: <b id="displayCultoAviso" style="color:var(--primary);">--</b>
            </p>
            <input type="hidden" id="inputCultoAviso">
            <textarea id="textoAvisoMembro" class="premium-input"
                placeholder="Ex: Não poderei ir por motivo de saúde..." rows="4"
                style="width:100%; margin-bottom:15px; border-radius:12px; border:1px solid #e2e8f0; padding:12px; font-family:inherit;"></textarea>
            <button id="btnEnviarAvisoMembro" class="btn-premium" onclick="enviarAvisoMembro()"
                style="width:100%; padding:14px; background:var(--primary); color:white; border:none; border-radius:12px; font-weight:700; cursor:pointer;">ENVIAR
                AVISO</button>
        </div>
    </div>

    <div class="premium-container" style="max-width: 1250px;">

        <div class="search-box" style="display: flex; gap: 10px; align-items: center; margin-bottom: 20px;">
            <div style="position: relative; flex-grow: 1;">
                <i class="fas fa-search"
                    style="position: absolute; left: 18px; top: 12px; color: #95a5a6; z-index: 1;"></i>
                <input type="text" id="personSearch" placeholder="Filtrar por nome..." onkeyup="renderCalendars()"
                    class="premium-input" style="padding-left: 45px;">
            </div>
            <button class="btn-export" onclick="exportarEscala()" id="btnExport"
                style="display: none; margin: 0; background: var(--primary); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: transform 0.2s;">
                <i class="fas fa-camera"></i>
            </button>
        </div>

        <div id="loader" class="loader" style="display:none; text-align: center; margin-bottom: 20px;"><i
                class="fas fa-sync fa-spin"></i> Carregando...</div>

        <div class="calendar-container" id="calendarsContainer"
            style="display:none; flex-direction: column; gap: 20px;">
            <div class="premium-card month-wrapper" id="month1" style="padding: 15px;"></div>
            <div class="premium-card month-wrapper" id="month2" style="padding: 15px;"></div>
        </div>

        <div id="eventModal" class="modal">
            <div class="modal-content">
                <span class="close-modal"
                    onclick="document.getElementById('eventModal').style.display='none'">&times;</span>
                <h3 id="modalDate" style="color: var(--primary); margin-top: 0;">Data</h3>
                <div id="modalDetails"></div>
            </div>
        </div>

        <!-- TEMPLATE PARA EXPORTAÇÃO -->
        <div id="exportTemplate">
            <div class="export-header">
                <img src="../../assets/backgroud.png" alt="Logo">
                <h2>MINHA ESCALA</h2>
                <p id="exportUserName">Nome do Integrante</p>
            </div>
            <div id="exportItems">
                <!-- Itens serão gerados via JS -->
            </div>
            <div class="export-footer">
                Gerado por Louvor CEVD App
            </div>
        </div>

        <!-- SCRIPTS DE DEPENDÊNCIA -->
        <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
        <script src="../../Shared/JS/sync.js"></script>
        <script src="../../Shared/JS/shared-forms.js"></script>
        <script src="../JS/escala-calendario.js"></script>

        <!-- MODAL NATIVO ÚNICO -->
        <div id="modalNativeContainer" class="modal"
            style="display:none; position:fixed; z-index:10002; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter:blur(10px); align-items:center; justify-content:center; padding:15px; transition: all 0.3s ease;">

            <div class="modal-content premium-card"
                style="border-radius:28px; width:100%; max-width:500px; padding:35px; position:relative; border-top: 10px solid var(--primary);">

                <style>
                    @keyframes modalReveal {
                        from {
                            opacity: 0;
                            transform: translateY(20px) scale(0.95);
                        }

                        to {
                            opacity: 1;
                            transform: translateY(0) scale(1);
                        }
                    }

                    #modalNativeContainer .field label {
                        font-size: 0.8rem;
                        letter-spacing: 0.05rem;
                        text-transform: uppercase;
                        color: var(--text-muted);
                        margin-bottom: 8px;
                        font-weight: 800;
                    }
                </style>

                <span onclick="closeNativeModal()"
                    style="position:absolute; right:20px; top:20px; width: 36px; height: 36px; border-radius: 50%; background: var(--bg-page); display: flex; align-items: center; justify-content: center; font-size:1.2rem; cursor:pointer; color:var(--text-muted); transition: all 0.2s; border: 1px solid rgba(0,0,0,0.05);">&times;</span>

                <h3 id="modalFormTitleNative"
                    style="margin-top:0; font-weight:900; color:var(--primary); font-size:1.4rem; margin-bottom:30px; text-align: center; letter-spacing: -0.02rem;">
                    Montar Repertório</h3>

                <!-- PAINEL REPERTÓRIO -->
                <div id="panelRepertorioNative">
                    <form id="repertorioFormNative">
                        <input type="hidden" name="sheet" value="Repertório_PWA">
                        <input type="hidden" name="action" value="addRow">
                        <input type="hidden" name="Data" id="hiddenDataNative">
                        <input type="hidden" name="Culto" id="hiddenNomeCultoNative">
                        <input type="hidden" name="Músicas" id="hiddenMusicaNative">
                        <input type="hidden" name="Cantor" id="hiddenCantorNative">
                        <input type="hidden" name="Tons" id="hiddenTonsNative">

                        <div class="field" style="margin-bottom:15px;">
                            <label
                                style="display:block; font-size:0.85rem; font-weight:700; color:#64748b; margin-bottom:5px;">Culto
                                Selecionado</label>
                            <select id="cultoSelectNative" required></select>
                        </div>
                        <div class="field" style="margin-bottom:15px;">
                            <label
                                style="display:block; font-size:0.85rem; font-weight:700; color:#64748b; margin-bottom:5px;">Ministro
                                (Escalados)</label>
                            <select id="ministroSelectNative" name="Ministro" required></select>
                        </div>
                        <div class="field" style="margin-bottom:15px;">
                            <label
                                style="display:block; font-size:0.85rem; font-weight:700; color:#64748b; margin-bottom:5px;">Música
                                - Cantor</label>
                            <select id="musicaSelectNative" required></select>
                            <div style="text-align:right; margin-top:5px; font-size:0.75rem">
                                <a href="javascript:void(0)" onclick="showNativeForm('musica')"
                                    style="color:var(--primary); text-decoration:none; font-weight:700;">Não
                                    encontrou? + Adicionar Nova Música</a>
                            </div>
                        </div>
                        <div class="field" style="margin-bottom:20px;">
                            <label>Tom (Opcional)</label>
                            <select id="tomSelectNative">
                                <option value="">Selecione...</option>
                                <option value="C / Am">C / Am</option>
                                <option value="C# / A#m">C# / A#m</option>
                                <option value="D / Bm">D / Bm</option>
                                <option value="D# / Cm">D# / Cm</option>
                                <option value="E / C#m">E / C#m</option>
                                <option value="F / Dm">F / Dm</option>
                                <option value="F# / D#m">F# / D#m</option>
                                <option value="G / Em">G / Em</option>
                                <option value="G# / Fm">G# / Fm</option>
                                <option value="A / F#m">A / F#m</option>
                                <option value="A# / Gm">A# / Gm</option>
                                <option value="B / G#m">B / G#m</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-premium" style="width:100%;">SALVAR NO REPERTÓRIO</button>
                    </form>
                    <div id="statusRepNative"
                        style="margin-top:15px; text-align:center; font-weight:700; color:var(--primary); display:none;">
                    </div>
                </div>

                <!-- PAINEL CADASTRO DE MÚSICA -->
                <div id="panelMusicaNative" style="display:none;">
                    <form id="musicFormNative">
                        <div class="field" style="margin-bottom:12px;">
                            <label
                                style="display:block; font-size:0.85rem; font-weight:700; color:#64748b; margin-bottom:5px;">Tema</label>
                            <select name="Tema" id="temaSelectNative" required></select>
                        </div>
                        <div class="field" style="margin-bottom:12px;">
                            <label
                                style="display:block; font-size:0.85rem; font-weight:700; color:#64748b; margin-bottom:5px;">Estilo</label>
                            <select name="Estilo" id="estiloSelectNative" required>
                                <option value="Adoração">Adoração</option>
                                <option value="Celebração">Celebração</option>
                            </select>
                        </div>
                        <div class="field" style="margin-bottom:12px;">
                            <label
                                style="display:block; font-size:0.85rem; font-weight:700; color:#64748b; margin-bottom:5px;">Nome
                                da Música</label>
                            <input type="text" name="Musica" class="premium-input" placeholder="Ex: A Terra Clama"
                                required>
                        </div>
                        <div class="field" style="margin-bottom:20px;">
                            <label
                                style="display:block; font-size:0.85rem; font-weight:700; color:#64748b; margin-bottom:5px;">Cantor
                                / Banda</label>
                            <input type="text" name="Cantor" class="premium-input" placeholder="Ex: Davi Fernandes"
                                required>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button type="button" onclick="showNativeForm('repertorio')" class="btn-premium"
                                style="flex:1; background:#94a3b8 !important;">VOLTAR</button>
                            <button type="submit" class="btn-premium" style="flex:2;">SALVAR
                                MÚSICA</button>
                        </div>
                    </form>
                    <div id="statusMusNative"
                        style="margin-top:15px; text-align:center; font-weight:700; color:var(--primary); display:none;">
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>